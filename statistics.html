<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë¡œë˜ í†µê³„ ëŒ€ì‹œë³´ë“œ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<style>
body{
    margin:0;
    font-family:'Roboto', sans-serif;
    background:#f1f3f4;
}

/* ìƒë‹¨ ì•±ë°” */
.appbar{
    position:fixed;
    top:0;
    width:100%;
    height:56px;
    background:#6200ea;
    color:white;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:18px;
    font-weight:500;
    box-shadow:0 2px 6px rgba(0,0,0,0.3);
    z-index:1000;
}

/* ì½˜í…ì¸  ì˜ì—­ */
.content{
    padding:80px 16px 100px;
    max-width:900px;
    margin:auto;
}

/* ì¹´ë“œ */
.card{
    background:white;
    padding:18px;
    margin-bottom:20px;
    border-radius:16px;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
}

.card h2{
    margin-top:0;
    font-size:18px;
}

select{
    padding:8px;
    border-radius:8px;
    border:1px solid #ddd;
    margin-top:8px;
}

/* ì°¨íŠ¸ ë°˜ì‘í˜• */
canvas{
    margin-top:15px;
}

/* í•˜ë‹¨ ë„¤ë¹„ */
.bottom-nav{
    position:fixed;
    bottom:0;
    width:100%;
    height:65px;
    background:white;
    display:flex;
    justify-content:space-around;
    align-items:center;
    box-shadow:0 -2px 8px rgba(0,0,0,0.1);
}

.bottom-nav a{
    text-decoration:none;
    color:#555;
    font-size:12px;
    text-align:center;
}

.bottom-nav a.active{
    color:#6200ea;
    font-weight:500;
}
</style>
</head>

<body>

<div class="appbar">ğŸ“Š ë¡œë˜ í†µê³„ ëŒ€ì‹œë³´ë“œ</div>

<div class="content">

<div class="card">
  <h2>ì „ì²´ íšŒì°¨ ê¸°ì¤€ ë²ˆí˜¸ ì¶œí˜„ íšŸìˆ˜</h2>
  <canvas id="allTimeChart"></canvas>
</div>

<div class="card">
  <h2>50íšŒ ë‹¨ìœ„ ë²ˆí˜¸ í†µê³„</h2>
  <label>êµ¬ê°„ ì„ íƒ</label><br>
  <select id="rangeSelect"></select>
  <canvas id="rangeChart"></canvas>
</div>

<div class="card">
  <h2>ì „ì²´ ë³´ë„ˆìŠ¤ ë²ˆí˜¸ ì¶œí˜„ íšŸìˆ˜</h2>
  <canvas id="bonusChart"></canvas>
</div>

<div class="card">
  <h2>50íšŒ ë‹¨ìœ„ ë³´ë„ˆìŠ¤ ë²ˆí˜¸ í†µê³„</h2>
  <label>êµ¬ê°„ ì„ íƒ</label><br>
  <select id="bonusRangeSelect"></select>
  <canvas id="bonusRangeChart"></canvas>
</div>

</div>

<!-- í•˜ë‹¨ ë„¤ë¹„ -->
<div class="bottom-nav">
    <a href="index.html">ğŸ  ìƒì„±</a>
    <a href="winning.html">ğŸ† ë‹¹ì²¨</a>
    <a href="statistics.html">ğŸ“Š í†µê³„</a>
    <a href="dashboard.html" class="active">ğŸ“ˆ ëŒ€ì‹œë³´ë“œ</a>
</div>

<script>

let lottoData = [];

let allTimeChartInstance = null;
let rangeChartInstance = null;
let bonusChartInstance = null;
let bonusRangeChartInstance = null;

async function loadLotto(){
    try{
        const res = await fetch("./lotto_data.json");
        lottoData = await res.json();
        renderPage();
    }catch(e){
        console.error("ë¡œë˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", e);
    }
}

function initCount() {
    let count = {};
    for (let i = 1; i <= 45; i++) count[i] = 0;
    return count;
}

function calculateFrequency(data) {
    let count = initCount();
    data.forEach(draw => {
        draw.numbers.forEach(n => count[n]++);
    });
    return count;
}

function calculateBonusFrequency(data) {
    let count = initCount();
    data.forEach(draw => {
        count[draw.bonus]++;
    });
    return count;
}

function createChart(canvasId, freqData, label, existingChart) {

    if (existingChart) existingChart.destroy();

    return new Chart(document.getElementById(canvasId), {
        type: 'bar',
        data: {
            labels: Object.keys(freqData),
            datasets: [{
                label: label,
                data: Object.values(freqData)
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: true }
            }
        }
    });
}

function setupRangeSelectors() {

    const rangeSelect = document.getElementById("rangeSelect");
    const bonusRangeSelect = document.getElementById("bonusRangeSelect");

    rangeSelect.innerHTML = "";
    bonusRangeSelect.innerHTML = "";

    for (let i = 0; i < lottoData.length; i += 50) {
        let end = Math.min(i + 50, lottoData.length);
        let label = `${i+1}íšŒ ~ ${end}íšŒ`;

        let option1 = document.createElement("option");
        option1.value = i;
        option1.text = label;
        rangeSelect.appendChild(option1);

        let option2 = document.createElement("option");
        option2.value = i;
        option2.text = label;
        bonusRangeSelect.appendChild(option2);
    }

    rangeSelect.addEventListener("change", function() {
        const start = parseInt(this.value);
        const rangeData = lottoData.slice(start, start + 50);

        rangeChartInstance = createChart(
            "rangeChart",
            calculateFrequency(rangeData),
            "ì„ íƒ êµ¬ê°„ ë²ˆí˜¸ ì¶œí˜„ íšŸìˆ˜",
            rangeChartInstance
        );
    });

    bonusRangeSelect.addEventListener("change", function() {
        const start = parseInt(this.value);
        const rangeData = lottoData.slice(start, start + 50);

        bonusRangeChartInstance = createChart(
            "bonusRangeChart",
            calculateBonusFrequency(rangeData),
            "ì„ íƒ êµ¬ê°„ ë³´ë„ˆìŠ¤ ë²ˆí˜¸ ì¶œí˜„ íšŸìˆ˜",
            bonusRangeChartInstance
        );
    });

    if (lottoData.length > 0) {
        const defaultRange = lottoData.slice(0, 50);

        rangeChartInstance = createChart(
            "rangeChart",
            calculateFrequency(defaultRange),
            "ì„ íƒ êµ¬ê°„ ë²ˆí˜¸ ì¶œí˜„ íšŸìˆ˜",
            rangeChartInstance
        );

        bonusRangeChartInstance = createChart(
            "bonusRangeChart",
            calculateBonusFrequency(defaultRange),
            "ì„ íƒ êµ¬ê°„ ë³´ë„ˆìŠ¤ ë²ˆí˜¸ ì¶œí˜„ íšŸìˆ˜",
            bonusRangeChartInstance
        );
    }
}

function renderPage(){

    allTimeChartInstance = createChart(
        "allTimeChart",
        calculateFrequency(lottoData),
        "ì „ì²´ ë²ˆí˜¸ ì¶œí˜„ íšŸìˆ˜",
        allTimeChartInstance
    );

    bonusChartInstance = createChart(
        "bonusChart",
        calculateBonusFrequency(lottoData),
        "ì „ì²´ ë³´ë„ˆìŠ¤ ë²ˆí˜¸ ì¶œí˜„ íšŸìˆ˜",
        bonusChartInstance
    );

    setupRangeSelectors();
}

loadLotto();

</script>

</body>
</html>
