<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë¡œë˜ í†µê³„ | Luckyty</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  margin: 0;
  font-family: "Noto Sans KR", sans-serif;
  background: #f1f3f6;
}

/* ===== HEADER ===== */
.header {
  background: #1976d2;
  color: white;
  padding: 16px;
  font-size: 20px;
  font-weight: bold;
  text-align: center;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

/* ===== CONTAINER ===== */
.container {
  padding: 15px;
  max-width: 900px;
  margin: auto;
}

/* ===== CARD ===== */
.card {
  background: white;
  padding: 18px;
  margin-bottom: 20px;
  border-radius: 14px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.08);
}

.card h2 {
  margin-top: 0;
  font-size: 18px;
}

/* ===== SELECT ===== */
select {
  padding: 6px 10px;
  border-radius: 8px;
  border: 1px solid #ddd;
  margin-top: 10px;
  font-size: 14px;
}

/* ===== CHART ===== */
.chart-wrapper {
  position: relative;
  height: 320px;
  margin-top: 15px;
}

/* í•˜ë‹¨ ë„¤ë¹„ */
.bottom-nav{
    position:fixed;
    bottom:0;
    width:100%;
    height:65px;
    background:white;
    display:flex;
    justify-content:space-around;
    align-items:center;
    box-shadow:0 -2px 8px rgba(0,0,0,0.1);
}

.bottom-nav a{
    text-decoration:none;
    color:#555;
    font-size:12px;
    text-align:center;
}

.bottom-nav a.active{
    color:#6200ea;
    font-weight:500;
}
/* ===== MOBILE ===== */
@media (max-width: 600px) {
  .header {
    font-size: 16px;
  }
  .card h2 {
    font-size: 15px;
  }
}
</style>
</head>
<body>

<div class="header">
  ğŸ“Š Luckyty ë¡œë˜ í†µê³„ ëŒ€ì‹œë³´ë“œ
</div>

<div class="container">

  <div class="card">
    <h2>ì „ì²´ ë²ˆí˜¸ ì¶œí˜„ íšŸìˆ˜</h2>
    <div class="chart-wrapper">
      <canvas id="allTimeChart"></canvas>
    </div>
  </div>

  <div class="card">
    <h2>50íšŒ ë‹¨ìœ„ ë²ˆí˜¸ í†µê³„</h2>
    <select id="rangeSelect"></select>
    <div class="chart-wrapper">
      <canvas id="rangeChart"></canvas>
    </div>
  </div>

  <div class="card">
    <h2>ì „ì²´ ë³´ë„ˆìŠ¤ ë²ˆí˜¸ ì¶œí˜„ íšŸìˆ˜</h2>
    <div class="chart-wrapper">
      <canvas id="bonusChart"></canvas>
    </div>
  </div>

  <div class="card" style="margin: 0 0 70px 0;">
    <h2>50íšŒ ë‹¨ìœ„ ë³´ë„ˆìŠ¤ ë²ˆí˜¸ í†µê³„</h2>
    <select id="bonusRangeSelect"></select>
    <div class="chart-wrapper">
      <canvas id="bonusRangeChart"></canvas>
    </div>
  </div>

</div>

<div class="bottom-nav">
    <a href="index.html">ğŸ  ìƒì„±</a>
    <a href="winning.html">ğŸ† ë‹¹ì²¨</a>
    <a href="statistics.html" class="active">ğŸ“Š í†µê³„</a>
    <a href="aisgst.html">ğŸ¤– AI</a>
    <a href="dashboard.html">ğŸ“ˆ ëŒ€ì‹œë³´ë“œ</a>
</div>

<script>

let lottoData = [];

// ì°¨íŠ¸ ì „ì—­ ê´€ë¦¬ ê°ì²´
const chartStore = {};

async function loadLotto(){
    const res = await fetch("./lotto_data.json");
    lottoData = await res.json();
    renderPage();
}

function initCount() {
    let count = {};
    for (let i = 1; i <= 45; i++) count[i] = 0;
    return count;
}

function calculateFrequency(data) {
    let count = initCount();
    data.forEach(draw => {
        draw.numbers.forEach(n => count[n]++);
    });
    return count;
}

function calculateBonusFrequency(data) {
    let count = initCount();
    data.forEach(draw => {
        count[draw.bonus]++;
    });
    return count;
}

function createChart(canvasId, freqData, label, color) {

    const ctx = document.getElementById(canvasId).getContext("2d");

    if (chartStore[canvasId]) {
        chartStore[canvasId].destroy();
    }

    chartStore[canvasId] = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: Object.keys(freqData),
            datasets: [{
                label: label,
                data: Object.values(freqData),
                backgroundColor: color
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: true }
            },
            animation: {
                duration: 800
            }
        }
    });
}

function setupRangeSelectors() {

    const rangeSelect = document.getElementById("rangeSelect");
    const bonusRangeSelect = document.getElementById("bonusRangeSelect");

    rangeSelect.innerHTML = "";
    bonusRangeSelect.innerHTML = "";

    for (let i = 0; i < lottoData.length; i += 50) {
        let end = Math.min(i + 50, lottoData.length);
        let label = `${i+1}íšŒ ~ ${end}íšŒ`;

        let option1 = new Option(label, i);
        let option2 = new Option(label, i);

        rangeSelect.add(option1);
        bonusRangeSelect.add(option2);
    }

    rangeSelect.addEventListener("change", function() {
        const start = parseInt(this.value);
        const rangeData = lottoData.slice(start, start + 50);
        createChart("rangeChart",
            calculateFrequency(rangeData),
            "ì„ íƒ êµ¬ê°„ ë²ˆí˜¸ ì¶œí˜„",
            "#42a5f5"
        );
    });

    bonusRangeSelect.addEventListener("change", function() {
        const start = parseInt(this.value);
        const rangeData = lottoData.slice(start, start + 50);
        createChart("bonusRangeChart",
            calculateBonusFrequency(rangeData),
            "ì„ íƒ êµ¬ê°„ ë³´ë„ˆìŠ¤ ì¶œí˜„",
            "#ef5350"
        );
    });

    if (lottoData.length > 0) {
        const defaultRange = lottoData.slice(0, 50);

        createChart("rangeChart",
            calculateFrequency(defaultRange),
            "ì„ íƒ êµ¬ê°„ ë²ˆí˜¸ ì¶œí˜„",
            "#42a5f5"
        );

        createChart("bonusRangeChart",
            calculateBonusFrequency(defaultRange),
            "ì„ íƒ êµ¬ê°„ ë³´ë„ˆìŠ¤ ì¶œí˜„",
            "#ef5350"
        );
    }
}

function renderPage(){

    createChart("allTimeChart",
        calculateFrequency(lottoData),
        "ì „ì²´ ë²ˆí˜¸ ì¶œí˜„",
        "#1976d2"
    );

    createChart("bonusChart",
        calculateBonusFrequency(lottoData),
        "ì „ì²´ ë³´ë„ˆìŠ¤ ì¶œí˜„",
        "#ff9800"
    );

    setupRangeSelectors();
}

loadLotto();

</script>

</body>
</html>
