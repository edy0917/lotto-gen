<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë¡œë˜ í†µê³„ ëŒ€ì‹œë³´ë“œ | Luckyty</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
  background: #f4f6f9;
}
h1 { text-align: center; }
.card {
  background: white;
  padding: 20px;
  margin-bottom: 30px;
  border-radius: 10px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}
select { padding: 5px; margin-left: 10px; }
canvas { margin-top: 20px; }
</style>
</head>
<body>

<h1>ğŸ“Š ë¡œë˜ í†µê³„ ëŒ€ì‹œë³´ë“œ</h1>

<div class="card">
  <h2>ì „ì²´ íšŒì°¨ ê¸°ì¤€ ë²ˆí˜¸ ì¶œí˜„ íšŸìˆ˜</h2>
  <canvas id="allTimeChart"></canvas>
</div>

<div class="card">
  <h2>50íšŒ ë‹¨ìœ„ ë²ˆí˜¸ í†µê³„</h2>
  <label>êµ¬ê°„ ì„ íƒ:</label>
  <select id="rangeSelect"></select>
  <canvas id="rangeChart"></canvas>
</div>

<div class="card">
  <h2>ì „ì²´ ë³´ë„ˆìŠ¤ ë²ˆí˜¸ ì¶œí˜„ íšŸìˆ˜</h2>
  <canvas id="bonusChart"></canvas>
</div>

<div class="card">
  <h2>50íšŒ ë‹¨ìœ„ ë³´ë„ˆìŠ¤ ë²ˆí˜¸ í†µê³„</h2>
  <label>êµ¬ê°„ ì„ íƒ:</label>
  <select id="bonusRangeSelect"></select>
  <canvas id="bonusRangeChart"></canvas>
</div>

<script>

let lottoData = [];

let allTimeChartInstance = null;
let rangeChartInstance = null;
let bonusChartInstance = null;
let bonusRangeChartInstance = null;

async function loadLotto(){
    try{
        const res = await fetch("./lotto_data.json");
        lottoData = await res.json();
        renderPage();
    }catch(e){
        console.error("ë¡œë˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", e);
    }
}

function initCount() {
    let count = {};
    for (let i = 1; i <= 45; i++) count[i] = 0;
    return count;
}

function calculateFrequency(data) {
    let count = initCount();
    data.forEach(draw => {
        draw.numbers.forEach(n => count[n]++);
    });
    return count;
}

function calculateBonusFrequency(data) {
    let count = initCount();
    data.forEach(draw => {
        count[draw.bonus]++;
    });
    return count;
}

function createChart(canvasId, freqData, label, existingChart) {

    if (existingChart) existingChart.destroy();

    const labels = Object.keys(freqData);
    const values = Object.values(freqData);

    return new Chart(document.getElementById(canvasId), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: label,
                data: values
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: true }
            }
        }
    });
}

function setupRangeSelectors() {

    const rangeSelect = document.getElementById("rangeSelect");
    const bonusRangeSelect = document.getElementById("bonusRangeSelect");

    rangeSelect.innerHTML = "";
    bonusRangeSelect.innerHTML = "";

    for (let i = 0; i < lottoData.length; i += 50) {
        let end = Math.min(i + 50, lottoData.length);
        let label = `${i+1}íšŒ ~ ${end}íšŒ`;

        let option1 = document.createElement("option");
        option1.value = i;
        option1.text = label;
        rangeSelect.appendChild(option1);

        let option2 = document.createElement("option");
        option2.value = i;
        option2.text = label;
        bonusRangeSelect.appendChild(option2);
    }

    // ë²ˆí˜¸ êµ¬ê°„ ë³€ê²½
    rangeSelect.addEventListener("change", function() {
        const start = parseInt(this.value);
        const rangeData = lottoData.slice(start, start + 50);
        const rangeFreq = calculateFrequency(rangeData);

        rangeChartInstance = createChart(
            "rangeChart",
            rangeFreq,
            "ì„ íƒ êµ¬ê°„ ë²ˆí˜¸ ì¶œí˜„ íšŸìˆ˜",
            rangeChartInstance
        );
    });

    // ë³´ë„ˆìŠ¤ êµ¬ê°„ ë³€ê²½
    bonusRangeSelect.addEventListener("change", function() {
        const start = parseInt(this.value);
        const rangeData = lottoData.slice(start, start + 50);
        const bonusFreq = calculateBonusFrequency(rangeData);

        bonusRangeChartInstance = createChart(
            "bonusRangeChart",
            bonusFreq,
            "ì„ íƒ êµ¬ê°„ ë³´ë„ˆìŠ¤ ë²ˆí˜¸ ì¶œí˜„ íšŸìˆ˜",
            bonusRangeChartInstance
        );
    });

    // ê¸°ë³¸ êµ¬ê°„ í‘œì‹œ
    if (lottoData.length > 0) {
        const defaultRange = lottoData.slice(0, 50);

        rangeChartInstance = createChart(
            "rangeChart",
            calculateFrequency(defaultRange),
            "ì„ íƒ êµ¬ê°„ ë²ˆí˜¸ ì¶œí˜„ íšŸìˆ˜",
            rangeChartInstance
        );

        bonusRangeChartInstance = createChart(
            "bonusRangeChart",
            calculateBonusFrequency(defaultRange),
            "ì„ íƒ êµ¬ê°„ ë³´ë„ˆìŠ¤ ë²ˆí˜¸ ì¶œí˜„ íšŸìˆ˜",
            bonusRangeChartInstance
        );
    }
}

function renderPage(){

    allTimeChartInstance = createChart(
        "allTimeChart",
        calculateFrequency(lottoData),
        "ì „ì²´ ë²ˆí˜¸ ì¶œí˜„ íšŸìˆ˜",
        allTimeChartInstance
    );

    bonusChartInstance = createChart(
        "bonusChart",
        calculateBonusFrequency(lottoData),
        "ì „ì²´ ë³´ë„ˆìŠ¤ ë²ˆí˜¸ ì¶œí˜„ íšŸìˆ˜",
        bonusChartInstance
    );

    setupRangeSelectors();
}

loadLotto();

</script>

</body>
</html>
