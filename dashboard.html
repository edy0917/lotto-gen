<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Luckyty ë¡œë˜ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  font-family:'Segoe UI',sans-serif;
  margin:0;
  padding:20px;
  background:#f0f2f5;
}
h1{text-align:center;margin-bottom:40px;}
.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(350px,1fr));
  gap:20px;
}
.card{
  background:white;
  padding:20px;
  border-radius:15px;
  box-shadow:0 4px 15px rgba(0,0,0,0.08);
}
.card h2{
  margin-top:0;
}
.rank-list li{
  margin:6px 0;
  font-weight:600;
}
.highlight{
  color:#e74c3c;
}
.hot{color:#e74c3c;font-weight:bold;}
.cold{color:#3498db;font-weight:bold;}
</style>
</head>
<body>

<h1>ğŸ¯ Luckyty ë¡œë˜ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h1>

<div class="dashboard">

<div class="card">
<h2>ğŸ“Š ì „ì²´ ë²ˆí˜¸ ì¶œí˜„ í†µê³„</h2>
<canvas id="allChart"></canvas>
</div>

<div class="card">
<h2>ğŸ† TOP10 ë²ˆí˜¸</h2>
<ul id="top10" class="rank-list"></ul>
</div>

<div class="card">
<h2>ğŸ”¥ í•« ë²ˆí˜¸ (ìµœê·¼100íšŒ)</h2>
<div id="hotNumbers"></div>
<h2>â„ ì½œë“œ ë²ˆí˜¸ (ìµœê·¼100íšŒ)</h2>
<div id="coldNumbers"></div>
</div>

<div class="card">
<h2>ğŸ“‰ ìµœê·¼100íšŒ ì¶”ì„¸</h2>
<canvas id="trendChart"></canvas>
</div>

<div class="card">
<h2>â³ ê°€ì¥ ì˜¤ë˜ ì•ˆ ë‚˜ì˜¨ ë²ˆí˜¸</h2>
<ul id="overdue" class="rank-list"></ul>
</div>

<div class="card">
<h2>ğŸ“Š ë²ˆí˜¸ êµ¬ê°„ ë¶„í¬</h2>
<canvas id="rangeDist"></canvas>
</div>

<div class="card">
<h2>ğŸ ë³´ë„ˆìŠ¤ ë²ˆí˜¸ TOP5</h2>
<ul id="bonusTop" class="rank-list"></ul>
</div>

</div>

<script>

let lottoData=[];

async function loadLotto(){
    const res=await fetch("./lotto_data.json");
    lottoData=await res.json();
    render();
}

function initCount(){
    let obj={};
    for(let i=1;i<=45;i++) obj[i]=0;
    return obj;
}

function calculateFrequency(data){
    let count=initCount();
    data.forEach(d=>{
        d.numbers.forEach(n=>count[n]++);
    });
    return count;
}

function calculateBonusFrequency(data){
    let count=initCount();
    data.forEach(d=>{
        count[d.bonus]++;
    });
    return count;
}

function sortDesc(obj){
    return Object.entries(obj)
        .sort((a,b)=>b[1]-a[1]);
}

function render(){

    const totalFreq=calculateFrequency(lottoData);
    const sorted=sortDesc(totalFreq);

    renderBarChart(totalFreq);
    renderTop10(sorted);
    renderHotCold();
    renderTrend();
    renderOverdue();
    renderRangeDist(totalFreq);
    renderBonus();
}

function renderBarChart(freq){
    const ctx=document.getElementById("allChart").getContext("2d");

    const gradient=ctx.createLinearGradient(0,0,0,400);
    gradient.addColorStop(0,"#ff7675");
    gradient.addColorStop(1,"#74b9ff");

    new Chart(ctx,{
        type:'bar',
        data:{
            labels:Object.keys(freq),
            datasets:[{
                label:"ì¶œí˜„ íšŸìˆ˜",
                data:Object.values(freq),
                backgroundColor:gradient
            }]
        },
        options:{
            responsive:true,
            plugins:{legend:{display:false}}
        }
    });
}

function renderTop10(sorted){
    const ul=document.getElementById("top10");
    sorted.slice(0,10).forEach((item,i)=>{
        ul.innerHTML+=`<li class="${i<3?'highlight':''}">${i+1}ìœ„ - ${item[0]}ë²ˆ (${item[1]}íšŒ)</li>`;
    });
}

function renderHotCold(){
    const recent=lottoData.slice(-100);
    const freq=calculateFrequency(recent);
    const sorted=sortDesc(freq);

    document.getElementById("hotNumbers").innerHTML=
        sorted.slice(0,5).map(x=>`<span class="hot">${x[0]} </span>`).join("");

    document.getElementById("coldNumbers").innerHTML=
        sorted.slice(-5).map(x=>`<span class="cold">${x[0]} </span>`).join("");
}

function renderTrend(){
    const recent=lottoData.slice(-100);
    const freq=calculateFrequency(recent);

    new Chart(document.getElementById("trendChart"),{
        type:'line',
        data:{
            labels:Object.keys(freq),
            datasets:[{
                label:"ìµœê·¼100íšŒ ì¶œí˜„",
                data:Object.values(freq),
                borderColor:"#6c5ce7",
                tension:0.3
            }]
        }
    });
}

function renderOverdue(){
    let lastSeen=initCount();

    lottoData.forEach((draw,i)=>{
        draw.numbers.forEach(n=>{
            lastSeen[n]=i;
        });
    });

    const totalIndex=lottoData.length;

    let overdue=Object.entries(lastSeen)
        .map(([num,idx])=>[num,totalIndex-idx])
        .sort((a,b)=>b[1]-a[1]);

    overdue.slice(0,5).forEach(item=>{
        document.getElementById("overdue").innerHTML+=
        `<li>${item[0]}ë²ˆ - ${item[1]}íšŒ ë¯¸ì¶œí˜„</li>`;
    });
}

function renderRangeDist(freq){
    let ranges={
        "1~10":0,
        "11~20":0,
        "21~30":0,
        "31~40":0,
        "41~45":0
    };

    for(let num in freq){
        let n=parseInt(num);
        if(n<=10) ranges["1~10"]+=freq[num];
        else if(n<=20) ranges["11~20"]+=freq[num];
        else if(n<=30) ranges["21~30"]+=freq[num];
        else if(n<=40) ranges["31~40"]+=freq[num];
        else ranges["41~45"]+=freq[num];
    }

    new Chart(document.getElementById("rangeDist"),{
        type:'doughnut',
        data:{
            labels:Object.keys(ranges),
            datasets:[{
                data:Object.values(ranges)
            }]
        }
    });
}

function renderBonus(){
    const freq=calculateBonusFrequency(lottoData);
    const sorted=sortDesc(freq);

    sorted.slice(0,5).forEach((item,i)=>{
        document.getElementById("bonusTop").innerHTML+=
        `<li>${i+1}ìœ„ - ${item[0]}ë²ˆ (${item[1]}íšŒ)</li>`;
    });
}

loadLotto();

</script>

</body>
</html>
