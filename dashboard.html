<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Luckyty ë¡œë˜ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  font-family:'Segoe UI',sans-serif;
  margin:0;
  background:#f4f6f9;
}

/* ===== HEADER ===== */
.header{
  background:#1976d2;
  color:white;
  padding:16px;
  text-align:center;
  font-size:18px;
  font-weight:bold;
  box-shadow:0 2px 8px rgba(0,0,0,0.2);
}

/* ===== LAYOUT ===== */
.container{
  padding:15px;
  max-width:1200px;
  margin:auto;
}

.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
  gap:15px;
}

/* ===== CARD ===== */
.card{
  background:white;
  padding:18px;
  border-radius:14px;
  box-shadow:0 3px 12px rgba(0,0,0,0.08);
}

.card h2{
  margin-top:0;
  font-size:16px;
}

.rank-list{
  padding-left:15px;
}

.rank-list li{
  margin:6px 0;
  font-weight:600;
}

.highlight{color:#e74c3c;}
.hot{color:#e74c3c;font-weight:bold;}
.cold{color:#3498db;font-weight:bold;}

/* ===== CHART FIX ===== */
.chart-wrapper{
  position:relative;
  height:300px;
}

/* í•˜ë‹¨ ë„¤ë¹„ */
.bottom-nav{
    position:fixed;
    bottom:0;
    width:100%;
    height:65px;
    background:white;
    display:flex;
    justify-content:space-around;
    align-items:center;
    box-shadow:0 -2px 8px rgba(0,0,0,0.1);
}

.bottom-nav a{
    text-decoration:none;
    color:#555;
    font-size:12px;
    text-align:center;
}

.bottom-nav a.active{
    color:#6200ea;
    font-weight:500;
}
/* ===== MOBILE ===== */
@media(max-width:600px){
  .dashboard{
    grid-template-columns:1fr;
  }
  .card h2{
    font-size:14px;
  }
  .header{
    font-size:16px;
  }
}
</style>
</head>
<body>

<div class="header">ğŸ¯ Luckyty ë¡œë˜ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</div>

<div class="container">

<div class="dashboard">

<div class="card">
<h2>ğŸ“Š ì „ì²´ ë²ˆí˜¸ ì¶œí˜„ í†µê³„</h2>
<div class="chart-wrapper">
<canvas id="allChart"></canvas>
</div>
</div>

<div class="card">
<h2>ğŸ† TOP10 ë²ˆí˜¸</h2>
<ul id="top10" class="rank-list"></ul>
</div>

<div class="card">
<h2>ğŸ”¥ í•« ë²ˆí˜¸ (ìµœê·¼100íšŒ)</h2>
<div id="hotNumbers"></div>
<h2 style="margin-top:15px;">â„ ì½œë“œ ë²ˆí˜¸ (ìµœê·¼100íšŒ)</h2>
<div id="coldNumbers"></div>
</div>

<div class="card">
<h2>ğŸ“‰ ìµœê·¼100íšŒ ì¶”ì„¸</h2>
<div class="chart-wrapper">
<canvas id="trendChart"></canvas>
</div>
</div>

<div class="card">
<h2>â³ ê°€ì¥ ì˜¤ë˜ ì•ˆ ë‚˜ì˜¨ ë²ˆí˜¸</h2>
<ul id="overdue" class="rank-list"></ul>
</div>

<div class="card">
<h2>ğŸ“Š ë²ˆí˜¸ êµ¬ê°„ ë¶„í¬</h2>
<div class="chart-wrapper">
<canvas id="rangeDist"></canvas>
</div>
</div>

<div class="card" style="margin: 0 0 70px 0;">
<h2>ğŸ ë³´ë„ˆìŠ¤ ë²ˆí˜¸ TOP5</h2>
<ul id="bonusTop" class="rank-list"></ul>
</div>

</div>
</div>
<div class="bottom-nav">
    <a href="index.html">ğŸ  ìƒì„±</a>
    <a href="winning.html">ğŸ† ë‹¹ì²¨</a>
    <a href="statistics.html">ğŸ“Š í†µê³„</a>
    <a href="aisgst.html">ğŸ¤– AI</a>
    <a href="dashboard.html" class="active">ğŸ“ˆ ëŒ€ì‹œë³´ë“œ</a>
</div>

<script>

let lottoData=[];
const chartStore={};

async function loadLotto(){
    const res=await fetch("./lotto_data.json");
    lottoData=await res.json();
    render();
}

function initCount(){
    let obj={};
    for(let i=1;i<=45;i++) obj[i]=0;
    return obj;
}

function calculateFrequency(data){
    let count=initCount();
    data.forEach(d=>{
        d.numbers.forEach(n=>count[n]++);
    });
    return count;
}

function calculateBonusFrequency(data){
    let count=initCount();
    data.forEach(d=>{
        count[d.bonus]++;
    });
    return count;
}

function sortDesc(obj){
    return Object.entries(obj).sort((a,b)=>b[1]-a[1]);
}

function destroyChart(id){
    if(chartStore[id]) chartStore[id].destroy();
}

function render(){

    const totalFreq=calculateFrequency(lottoData);
    const sorted=sortDesc(totalFreq);

    renderBarChart(totalFreq);
    renderTop10(sorted);
    renderHotCold();
    renderTrend();
    renderOverdue();
    renderRangeDist(totalFreq);
    renderBonus();
}

function renderBarChart(freq){
    destroyChart("allChart");

    chartStore["allChart"]=new Chart(document.getElementById("allChart"),{
        type:'bar',
        data:{
            labels:Object.keys(freq),
            datasets:[{
                data:Object.values(freq),
                backgroundColor:"#1976d2"
            }]
        },
        options:{responsive:true,maintainAspectRatio:false}
    });
}

function renderTop10(sorted){
    const ul=document.getElementById("top10");
    ul.innerHTML="";
    sorted.slice(0,10).forEach((item,i)=>{
        ul.innerHTML+=`<li class="${i<3?'highlight':''}">${i+1}ìœ„ - ${item[0]}ë²ˆ (${item[1]}íšŒ)</li>`;
    });
}

function renderHotCold(){
    const recent=lottoData.slice(-100);
    const freq=calculateFrequency(recent);
    const sorted=sortDesc(freq);

    document.getElementById("hotNumbers").innerHTML=
        sorted.slice(0,5).map(x=>`<span class="hot">${x[0]} </span>`).join("");

    document.getElementById("coldNumbers").innerHTML=
        sorted.slice(-5).map(x=>`<span class="cold">${x[0]} </span>`).join("");
}

function renderTrend(){
    destroyChart("trendChart");

    const recent=lottoData.slice(-100);
    const freq=calculateFrequency(recent);

    chartStore["trendChart"]=new Chart(document.getElementById("trendChart"),{
        type:'line',
        data:{
            labels:Object.keys(freq),
            datasets:[{
                data:Object.values(freq),
                borderColor:"#6c5ce7",
                tension:0.3
            }]
        },
        options:{responsive:true,maintainAspectRatio:false}
    });
}

function renderOverdue(){
    let lastSeen=initCount();
    lottoData.forEach((draw,i)=>{
        draw.numbers.forEach(n=>{
            lastSeen[n]=i;
        });
    });

    const totalIndex=lottoData.length;

    let overdue=Object.entries(lastSeen)
        .map(([num,idx])=>[num,totalIndex-idx])
        .sort((a,b)=>b[1]-a[1]);

    const ul=document.getElementById("overdue");
    ul.innerHTML="";
    overdue.slice(0,5).forEach(item=>{
        ul.innerHTML+=`<li>${item[0]}ë²ˆ - ${item[1]}íšŒ ë¯¸ì¶œí˜„</li>`;
    });
}

function renderRangeDist(freq){
    destroyChart("rangeDist");

    let ranges={"1~10":0,"11~20":0,"21~30":0,"31~40":0,"41~45":0};

    for(let num in freq){
        let n=parseInt(num);
        if(n<=10) ranges["1~10"]+=freq[num];
        else if(n<=20) ranges["11~20"]+=freq[num];
        else if(n<=30) ranges["21~30"]+=freq[num];
        else if(n<=40) ranges["31~40"]+=freq[num];
        else ranges["41~45"]+=freq[num];
    }

    chartStore["rangeDist"]=new Chart(document.getElementById("rangeDist"),{
        type:'doughnut',
        data:{labels:Object.keys(ranges),
              datasets:[{data:Object.values(ranges)}]},
        options:{responsive:true,maintainAspectRatio:false}
    });
}

function renderBonus(){
    const freq=calculateBonusFrequency(lottoData);
    const sorted=sortDesc(freq);

    const ul=document.getElementById("bonusTop");
    ul.innerHTML="";
    sorted.slice(0,5).forEach((item,i)=>{
        ul.innerHTML+=`<li>${i+1}ìœ„ - ${item[0]}ë²ˆ (${item[1]}íšŒ)</li>`;
    });
}

loadLotto();

</script>
</body>
</html>
